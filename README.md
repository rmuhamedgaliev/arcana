# Arcana - Движок текстовых приключенческих игр с Telegram ботом

Arcana - это движок текстовых приключенческих игр, который позволяет создавать и играть в текстовые квесты через Telegram бота. Он поддерживает несколько языков и загружает игры из JSON файлов.

## Возможности

- Движок текстовых приключенческих игр с поддержкой сцен, вариантов выбора и условий
- Многоязычная поддержка (в настоящее время английский и русский)
- Отслеживание прогресса для каждого пользователя
- Консольный интерфейс для тестирования
- Интерфейс Telegram бота для игры
- Формат определения игры на основе JSON

## Структура проекта

- `src/main/java/io/github/rmuhamedgaliev/arcana/core/` - Основные компоненты игрового движка
- `src/main/java/io/github/rmuhamedgaliev/arcana/core/player/` - Классы, связанные с игроками
- `src/main/java/io/github/rmuhamedgaliev/arcana/core/quest/` - Классы квестов для загрузки игр из JSON
- `src/main/java/io/github/rmuhamedgaliev/arcana/` - Основные классы и интерфейсы
- `games/` - Директория для JSON файлов игр

## Как запустить

### Консольный интерфейс

Для запуска игры с консольным интерфейсом:

```bash
./gradlew run
```

### Telegram бот

#### Получение токена Telegram бота

Перед запуском бота вам нужно получить токен от Telegram:

1. Откройте Telegram и найдите BotFather (@BotFather)
2. Начните чат с BotFather и отправьте команду `/newbot`
3. Следуйте инструкциям для создания нового бота
4. После создания BotFather предоставит вам токен (например, `123456789:ABCDefGhIJKlmNoPQRsTUVwxyZ`)
5. Сохраните этот токен, так как он понадобится для запуска бота

#### Запуск бота

Для запуска игры с интерфейсом Telegram бота:

```bash
./gradlew shadowJar
java -jar build/libs/arcana-bot.jar <botUsername> <botToken> <gamesDirectory>
```

Замените:
- `<botUsername>` на имя пользователя вашего бота (без символа @)
- `<botToken>` на токен, предоставленный BotFather
- `<gamesDirectory>` на путь к директории, содержащей ваши JSON файлы игр (например, `games`)

Пример:
```bash
java -jar build/libs/arcana-bot.jar my_adventure_bot 123456789:ABCDefGhIJKlmNoPQRsTUVwxyZ games
```

#### Альтернатива: Использование переменных окружения

Для лучшей безопасности вы можете использовать переменные окружения для предоставления токена:

```bash
export TELEGRAM_BOT_USERNAME=my_adventure_bot
export TELEGRAM_BOT_TOKEN=123456789:ABCDefGhIJKlmNoPQRsTUVwxyZ
export GAMES_DIRECTORY=games

java -jar build/libs/arcana-bot.jar
```

## Создание игр

Игры определяются в JSON файлах. Каждый файл игры должен включать:

- Метаданные игры (ID, язык по умолчанию, начальные атрибуты)
- Квесты (сцены) с текстом и действиями (вариантами выбора)
- Локализации для нескольких языков

Смотрите файл `games/adventure.json` для примера.

### Структура JSON игры

```json
{
  "id": "game_id",
  "defaultLanguage": "en",
  "initialAttributes": {
    "attribute1": 100,
    "attribute2": 0
  },
  "startQuestId": "start_quest_id",
  "quests": [
    {
      "id": "quest_id",
      "text": "Quest text",
      "actions": [
        {
          "text": "Action text",
          "nextScene": "next_quest_id",
          "condition": "attribute >= value"
        }
      ],
      "isEnd": false,
      "attributes": {
        "attribute": "value"
      }
    }
  ],
  "localizations": [
    {
      "language": "language_code",
      "title": "Game title",
      "description": "Game description",
      "questTexts": {
        "quest_id": "Localized quest text"
      },
      "actionTexts": {
        "quest_id": {
          "action_index": "Localized action text"
        }
      }
    }
  ]
}
```

### Понимание атрибутов

Атрибуты - это ключевая особенность игрового движка, которая позволяет отслеживать характеристики игрока и создавать условный геймплей. Существует два типа атрибутов:

1. **Атрибуты игрока**: Это числовые значения, связанные с игроком, такие как здоровье, золото, сила и т.д.
2. **Атрибуты сцены**: Они определены в каждом квесте/сцене и могут изменять атрибуты игрока, когда игрок входит в эту сцену.

#### Начальные атрибуты

Раздел `initialAttributes` в JSON игры определяет начальные значения для атрибутов игрока:

```
"initialAttributes": {
  "health": 100,
  "gold": 0,
  "strength": 10
}
```

#### Атрибуты сцены

Каждый квест/сцена может иметь раздел `attributes`, который изменяет атрибуты игрока, когда игрок входит в эту сцену:

```
"attributes": {
  "health": "100",
  "gold": "+50",
  "strength": "-5"
}
```

Значения могут быть:
- Абсолютные значения (например, `"100"`) - Устанавливает атрибут ровно на 100
- Относительные добавления (например, `"+50"`) - Добавляет 50 к текущему золоту
- Относительные вычитания (например, `"-5"`) - Вычитает 5 из текущей силы

#### Условия

Действия могут иметь условия, которые проверяют атрибуты игрока:

```
"condition": "health >= 50"
```

Поддерживаемые операторы: `==`, `!=`, `>`, `<`, `>=`, `<=`

### Отображение статуса

После каждого действия игра будет отображать текущий статус всех атрибутов игрока, например:

```
Текущий статус: здоровье: 100, золото: 50, сила: 5
```

Это помогает игрокам отслеживать свои характеристики на протяжении всей игры.

### Создание редактора игр

Чтобы упростить создание и редактирование игр, вы можете создать редактор игр. Вот некоторые рекомендации по реализации редактора игр:

1. **Структура игры**: Редактор должен позволять создавать и редактировать все части структуры JSON игры:
   - Метаданные игры (ID, название, описание, язык по умолчанию)
   - Начальные атрибуты
   - Квесты/сцены с текстом и действиями
   - Локализации для нескольких языков

2. **Управление атрибутами**: Редактор должен предоставлять интерфейс для:
   - Определения начальных атрибутов игрока
   - Добавления атрибутов к сценам, которые изменяют атрибуты игрока
   - Установки условий для действий на основе атрибутов игрока

3. **Визуализация**: Рассмотрите возможность реализации визуального представления потока игры:
   - Графическое или древовидное представление, показывающее, как сцены связаны между собой
   - Выделение условных путей на основе атрибутов

4. **Тестирование**: Включите способ тестирования игры внутри редактора:
   - Режим предварительного просмотра для прохождения игры
   - Возможность установки начальных значений атрибутов для тестирования
   - Визуализация изменений атрибутов по мере прогресса игрока

5. **Экспорт/Импорт**: Редактор должен уметь:
   - Экспортировать игры в формат JSON, используемый движком
   - Импортировать существующие игры для редактирования
   - Проверять структуру игры, чтобы убедиться, что она совместима с движком

6. **Поддержка локализации**: Упростите добавление и редактирование локализаций:
   - Редактирование текста на разных языках бок о бок
   - Выделение отсутствующих переводов

Реализуя редактор игр с этими функциями, вы можете значительно упростить создание сложных текстовых приключений с богатым геймплеем на основе атрибутов.

## Лицензия

Этот проект лицензирован под лицензией MIT - см. файл LICENSE для подробностей.
